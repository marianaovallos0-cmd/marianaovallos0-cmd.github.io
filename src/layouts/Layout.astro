---
import "../styles/vars.css";
import "../styles/content.css";
import "../styles/layout.css";

import { ClientRouter } from "astro:transitions";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";

export interface Props {
    title?: string;
    description?: string;
    children?: any;
}

const { title, description } = Astro.props;
---

<!doctype html>
<html lang="en" data-theme="light">
    <head>
        <meta charset="UTF-8" />
        <meta name="description" content={description || "Clay Theme"} />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="generator" content={Astro.generator} />
        <title>{title || "Clay"}</title>

        <ClientRouter />

        <!-- Theme initialization BEFORE page renders -->
        <script is:inline>
            const savedTheme = localStorage.getItem("theme");
            if (savedTheme === "dark") {
                document.documentElement.setAttribute("data-theme", "dark");
            } else {
                document.documentElement.setAttribute("data-theme", "light");
            }
        </script>
    </head>

    <body class="site-wrapper">
        <Header title={title} />

        <main id="site-main" class="site-main">
            <div id="swup" class="transition-fade">
                <slot />
            </div>
        </main>

        <Footer />

        <script>
            function initNav() {
                const burger = document.querySelector(".nav-burger");
                const wrapper = document.querySelector(".site-wrapper");
                if (burger && wrapper) {
                    burger.addEventListener("click", (e) => {
                        e.preventDefault();
                        wrapper.classList.toggle("site-head-open");
                    });
                }
            }

            function initTheme() {
                const toggleBtn = document.getElementById("theme-toggle");

                const updateIcon = () => {
                    const isDark =
                        document.documentElement.getAttribute("data-theme") ===
                        "dark";

                    const sun = document.querySelector(".sun-icon");
                    const moon = document.querySelector(".moon-icon");

                    if (sun && moon) {
                        sun.style.display = isDark ? "inline-block" : "none";
                        moon.style.display = isDark ? "none" : "inline-block";
                    }
                };

                updateIcon();

                if (toggleBtn) {
                    toggleBtn.addEventListener("click", () => {
                        const current =
                            document.documentElement.getAttribute("data-theme");

                        const next = current === "dark" ? "light" : "dark";

                        document.documentElement.setAttribute(
                            "data-theme",
                            next,
                        );
                        localStorage.setItem("theme", next);

                        updateIcon();
                    });
                }
            }

            document.addEventListener("astro:page-load", () => {
                initNav();
                initTheme();
            });

            document.addEventListener("astro:after-swap", () => {
                const theme = localStorage.getItem("theme") || "light";
                document.documentElement.setAttribute("data-theme", theme);
            });
        </script>
    </body>
</html>
